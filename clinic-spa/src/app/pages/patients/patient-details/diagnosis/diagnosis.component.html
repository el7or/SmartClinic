<form #form="ngForm" aria-labelledby="title" [nbSpinner]="formLoading" nbSpinnerStatus="success">
  <h6><span>{{'Patient Diagnoses' | langg}}</span>:</h6>
  <table class="table">
    <tbody>
      <tr *ngFor="let item of patientDiagnoses; index as i;">
        <td class="tdTypeahead">
          <!-- <nb-select fullWidth [(ngModel)]="item.diagnosisId" [ngModelOptions]="{standalone: true}"
            [placeholder]="'Diagnosis' | langg" size="small">
            <nb-option *ngFor="let diagnose of diagnosisValues" [value]="diagnose.id">{{diagnose.text}}</nb-option>
          </nb-select> -->
          <input nbInput [(ngModel)]="item.diagnosisName" [typeahead]="diagnosisValues" typeaheadOptionField="text"
          (typeaheadOnSelect)="onSelectDiagnose($event,i)" (typeaheadNoResults)="item.isNameValid = !$event"
          (keyup)="!item.isNameValid || item.diagnosisName==''? isAnyNameInvalid = true : isAnyNameInvalid = false" [placeholder]="'Diagnosis' | langg" [isAnimated]="true"
             [typeaheadMinLength]="0" [ngModelOptions]="{standalone: true}" class="inputTypeahead font-weight-bold"
            [typeaheadScrollable]="true" [typeaheadOptionsInScrollableView]="15" fullWidth>
          <ng-container *ngIf="!item.isNameValid && item.diagnosisName != ''">
            <label class="error-message" langg>This Name does not exist! Do you add it to the
              list?</label>&nbsp;
            <button nbButton type="button" (click)="onAddNewItemToList(item);item.isNameValid=true" status="info"
              size="small" class="mt-2" langg>Add</button>
          </ng-container>
        </td>
        <td>
          <nb-select fullWidth [(ngModel)]="item.gradeId" [ngModelOptions]="{standalone: true}"
            [placeholder]="'Disease Severity' | langg">
            <nb-option *ngFor="let grade of diseaseValues" [value]="grade.id">{{grade.text}}</nb-option>
          </nb-select>
        </td>
        <td>
          <input nbInput [(ngModel)]="item.note" [ngModelOptions]="{standalone: true}" [placeholder]="'Notes' | langg"
            fullWidth>
        </td>
        <td class="label pt-3">
          <label><span>{{'Added Date' | langg}}</span>:&nbsp;<b>{{item.createdOn | localDateShort}}</b>
          </label>
        </td>
        <td>
          <button *ngIf="!item.id" (click)="onRemoveDiagnose(i)" nbButton [nbTooltip]="'Remove Diagnose' | langg" size="tiny"
            status="danger">
            <nb-icon icon="close-square"></nb-icon>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <button nbButton
    [disabled]="patientDiagnoses?.length &&!patientDiagnoses[patientDiagnoses?.length-1]?.diagnosisId"
    size="small" (click)="onAddDiagnose()" class="mx-1 mb-1">
    <nb-icon icon="plus-outline"></nb-icon><span>{{'Add Diagnose' | langg}}</span>
  </button>

  <div class="text-center nbButton-group">
    <button nbButton type="submit" (click)="onSave()" status="success"
      [disabled]="!patientDiagnoses?.length || (patientDiagnoses?.length &&!patientDiagnoses[patientDiagnoses?.length-1]?.diagnosisId)"
      >{{'Save' | langg}}</button>
    <button nbButton type="button" status="danger" (click)="location.back()">{{'Cancel' | langg}}</button>
  </div>
</form>

<swal #doneSwal [title]="'Success' | langg" [text]="'Done successfully!' | langg" icon="success" timer="2000"
  [showConfirmButton]="false">
</swal>

<swal #deleteSwal icon="error" showCancelButton="true" focusCancel="true" [title]="'Attention !' | langg"
  [text]="'This data will be deleted forever and all other data related to it, and it will not be retrievable again!' | langg"
  [confirmButtonText]="'Delete' | langg" [cancelButtonText]="'Cancel' | langg" confirmButtonColor="#ff3d71">
</swal>
