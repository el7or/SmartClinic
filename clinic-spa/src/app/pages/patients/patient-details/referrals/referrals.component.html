<nb-card>
  <nb-card-body>
    <h6 langg>Add New Referral:</h6>
    <form #form="ngForm" aria-labelledby="title" [nbSpinner]="formLoading" nbSpinnerStatus="success">
      <table class="table requests">
        <tbody>
          <tr>
            <td>
              <nb-select ngModel #specialty="ngModel" name="specialty" required
                [placeholder]="'Specialty' | langg" size="small" (selectedChange)="onChangeReferralValue($event)" fullWidth>
                <nb-option *ngFor="let specialty of specialtyValues" [value]="specialty.specialtyId">
                  {{specialty.specialtyName}}
                </nb-option>
              </nb-select>
            </td>
            <td>
              <nb-select *ngIf="doctorValues?.length" ngModel #doctor="ngModel" name="doctor" required [placeholder]="'Doctor Name' | langg" size="small" fullWidth>
                <nb-option *ngFor="let doctor of doctorValues" [value]="doctor.doctorId" >
                  {{doctor.doctorName}}</nb-option>
              </nb-select>
            </td>
            <td>
              <nb-select *ngIf="doctorValues?.length"  ngModel #diagnose="ngModel" name="diagnose"
                [placeholder]="'Diagnosis' | langg" size="small" fullWidth>
                <nb-option *ngFor="let diagnose of patientDiagnosis" [value]="diagnose.id">
                  {{diagnose.text}}</nb-option>
              </nb-select>
              <ng-container *ngIf="!patientDiagnosis.length">
                <label class="error-message" langg>No Patient Diagnosis was recorded in the Patient Record.</label>
              </ng-container>
            </td>
            <td>
              <input *ngIf="doctorValues?.length" nbInput ngModel #note="ngModel" name="note"
                [placeholder]="'Notes' | langg" fullWidth fieldSize="small">
            </td>
            <td class="label pt-2">
              <label *ngIf="doctorValues?.length"><span langg>Referral
                  Date</span>:&nbsp;<b>{{today | localDateShort}}</b>
              </label>
            </td>
            <!-- <td>
              <button (click)="onRemoveReferral(i)" nbButton [nbTooltip]="'Remove Referral' | langg" size="tiny"
                status="danger">
                <nb-icon icon="close-square"></nb-icon>
              </button>
            </td> -->
          </tr>
        </tbody>
      </table>

      <!-- <button nbButton size="small" (click)="onAddReferral('pt')"
        [disabled]="referrals[0]?.type && (!referrals[0]?.name || !referrals[0]?.isNameValid)" class="mx-1 mb-1">
        <nb-icon icon="plus-outline"></nb-icon><span langg>Physical Therapy</span>
      </button>
      <button nbButton size="small" (click)="onAddReferral('hospital')"
        [disabled]="referrals[0]?.type && (!referrals[0]?.name || !referrals[0]?.isNameValid)" class="mx-1 mb-1">
        <nb-icon icon="plus-outline"></nb-icon><span langg>Hospital Referral</span>
      </button> -->

      <div class="text-center nbButton-group mb-1">
        <button nbButton type="submit" status="success" (click)="onSave(form,false)"
          [disabled]="form.invalid || !form.touched" langg>Save</button>
        <button nbButton type="submit" status="success" (click)="onSave(form,true)"
          [disabled]="form.invalid || !form.touched" langg>Save & Print Referral</button>
        <button nbButton type="button" status="danger" (click)="location.back()" langg>Cancel</button>
      </div>
    </form>

    <h6 langg>Past Referrals:</h6>
    <table class="table table-bordered">
      <thead class="thead-light">
        <tr>
          <th langg>Referral Date</th>
          <th langg>Referral to Specialty</th>
          <th langg>Referral to Doctor</th>
          <th langg>Patient Diagnosis</th>
          <th langg>Note</th>
        </tr>
      </thead>
      <tbody *ngIf="!prevPatientReferrals?.length">
        <tr>
          <td colspan="6" class="text-center">
            <h5 langg>No Results !</h5>
          </td>
        </tr>
      </tbody>
      <tbody *ngIf="prevPatientReferrals?.length">
        <tr *ngFor="let ref of prevPatientReferrals">
          <td>{{ref.createdOn | localDateShort}}</td>
          <td>{{ref.specialtyName}}</td>
          <td>{{ref.doctorName}}</td>
          <td>{{ref.diagnosisName}}</td>
          <td>{{ref.note}}</td>
        </tr>
      </tbody>
    </table>
  </nb-card-body>
</nb-card>

<swal #doneSwal [title]="'Success' | langg" [text]="'Done successfully!' | langg" icon="success" timer="2000"
  [showConfirmButton]="false">
</swal>

<swal #deleteSwal icon="error" showCancelButton="true" focusCancel="true" [title]="'Attention !' | langg"
  [text]="'This data will be deleted forever and all other data related to it, and it will not be retrievable again!' | langg"
  [confirmButtonText]="'Delete' | langg" [cancelButtonText]="'Cancel' | langg" confirmButtonColor="#ff3d71">
</swal>
